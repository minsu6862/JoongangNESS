<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<div layout:fragment="content">

    <!-- 게시글 상세 -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h3 th:text="${board.subject}" class="fw-bold"></h3>
            <p class="text-muted mb-2">
                작성자: <span th:if="${board.author != null}" th:text="${board.author.memberName}">익명</span>
                	<span th:unless="${board.author != null}">익명</span> |
                <span th:text="${#temporals.format(board.createDate.atZone(T(java.time.ZoneId).of('UTC'))
                                                .withZoneSameInstant(T(java.time.ZoneId).of('Asia/Seoul')),
                                                'yyyy-MM-dd HH:mm')}"></span>
            </p>
            <hr>
            <p th:text="${board.content}"></p>
            
            <!-- 게시글 수정/삭제 버튼 -->
            <div class="d-flex justify-content-end gap-2 mt-3">
                <a class="btn btn-sm btn-outline-primary"
                	th:href="@{|/board/modify/${board.id}|}" sec:authorize="isAuthenticated()"
                	th:if="${board.author != null and board.author.memberName == #authentication.getPrincipal().getUsername()}"
					th:text="수정">수정 버튼</a>
                   
                <a class="btn btn-sm btn-outline-danger delete" href="javascript:void(0);"
                	th:data-uri="@{|/board/delete/${board.id}|}" sec:authorize="isAuthenticated()"
                	th:if="${board.author != null and board.author.memberName == #authentication.getPrincipal().getUsername()}"
					th:text="삭제">삭제 버튼</a>
            </div>
            
        </div>
    </div> 
    <!-- 댓글 목록 -->
    <h5 class="fw-bold mb-3" style="color:#0a2342;">댓글</h5>
    <div th:each="comment : ${board.commentList}" class="mb-3 border-bottom pb-2">
        <p class="mb-1"><b th:id="|comment_${comment.id}|"></b></p>
        <p th:text="${comment.content}"></p>
        
        <div>
        <small class="text-muted" th:text="${#temporals.format(comment.createDate.atZone(T(java.time.ZoneId).of('UTC'))
                                                .withZoneSameInstant(T(java.time.ZoneId).of('Asia/Seoul')),
                                                'yyyy-MM-dd HH:mm')}"></small>
                                                
      	<!-- 댓글 수정/삭제 버튼 -->
            <a class="comment-action text-primary small me-2"
            	th:href="@{|/comment/modify/${comment.id}|}" sec:authorize="isAuthenticated()"
                th:if="${comment.member != null and comment.member.memberName == #authentication.getPrincipal().getUsername()}"
				th:text="수정">수정</a>
               
            <a class="comment-action text-danger small delete" href="javascript:void(0);"
                th:data-uri="@{|/comment/delete/${comment.id}|}" sec:authorize="isAuthenticated()"
                th:if="${comment.member != null and comment.member.memberName == #authentication.getPrincipal().getUsername()}"
				th:text="삭제">삭제</a>
        </div>
                                                
    </div>

    <!-- 댓글 작성 -->
    <form th:action="@{|/comment/write/${board.id}|}" th:object="${commentForm}" method="post" class="mt-4">
    	<!-- 유효성 체크 에러 표시 -->
		<div th:replace="~{form_errors :: formErrorsFragment}"></div>
		
        <div class="mb-3">
            <textarea class="form-control" name="content" rows="3" placeholder="댓글을 입력하세요"></textarea>
        </div>
        <div class="d-flex justify-content-between">
        	<!-- 로그인 여부에 따른 버튼 -->
	        <button sec:authorize="isAnonymous()" type="submit" class="btn btn-gold" disabled>댓글 등록</button>
	        <button sec:authorize="isAuthenticated()" type="submit" class="btn btn-gold">댓글 등록</button>
	
	        <!-- 목록 버튼 -->
	        <a th:href="@{/board/list}" class="btn btn-secondary">목록</a>
	    </div>
    </form>
</div>

	<!-- 자바스크립트 작성 -->
	<script layout:fragment="script" type="text/javascript">
		const delete_elements = document.getElementsByClassName("delete");
		Array.from(delete_elements).forEach(function (element) {
			element.addEventListener('click', function () {
				if (confirm("정말로 삭제하시겠습니까?")) {
					location.href = this.dataset.uri;
				};
			});
		});	
	</script>
</html>